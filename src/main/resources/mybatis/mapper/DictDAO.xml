<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE mapper
	PUBLIC "-//mybatis.org//DTO Mapper 3.0//EN"
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<!-- 컨트롤러가 호출하는 인터페이스의 위치를 namespace로 지정한다. -->
<mapper namespace="com.edu.springboot.dict.IDictService">

	<select id="selectOne" parameterType="int"
		resultType="com.edu.springboot.dict.DictDTO">
		SELECT * from plantdict where plantidx = #{plantidx}
	</select>

	<select id="selectAll"
		resultType="com.edu.springboot.dict.DictDTO">
		SELECT * from plantdict
		ORDER BY plantidx DESC
	</select>
	
	<select id="selectAllPlantidx"
		resultType="Integer">
		SELECT plantidx from plantdict
	</select>

	<select id="selectPlantsByUser"
		resultType="com.edu.springboot.dict.DictDTO">
		SELECT d.plantidx, d.name, d.imgpath, d.summary
		FROM PLANTDICT d
		WHERE d.plantidx IN (
		SELECT DISTINCT plantidx
		FROM DIARY
		WHERE userid = #{userId}
		)
		ORDER BY d.plantidx
	</select>
	
	<!-- 관리자: 식물도감 등록 -->
   <insert id="insertPlantDict" parameterType="com.edu.springboot.dict.DictDTO">
	    INSERT INTO plantdict (
	        plantidx, name, engname, category, imgpath,
	        growseason, bloomingseason, sunlight, humidity, temperature,
	        water, disease, summary, note
	    ) VALUES (
	        #{plantidx},
	        #{name, jdbcType=VARCHAR},
	        #{engname, jdbcType=VARCHAR},
	        #{category, jdbcType=VARCHAR},
	        #{imgpath, jdbcType=VARCHAR},
	        #{growseason , jdbcType=VARCHAR},
	        #{bloomingseason, jdbcType=VARCHAR},
	        #{sunlight, jdbcType=VARCHAR},
	        #{humidity, jdbcType=VARCHAR},
	        #{temperature, jdbcType=VARCHAR},
	        #{water, jdbcType=VARCHAR},
	        #{disease, jdbcType=VARCHAR},
	        #{summary, jdbcType=VARCHAR},
	        #{note, jdbcType=VARCHAR}
	    )
	</insert>

	
	<!-- plantidx 시퀀스 -->
	<select id="getMaxPlantIdx" resultType="int">
	  SELECT NVL(MAX(plantidx), 0) FROM plantdict
	</select>

    <!-- 관리자: 식물도감 전체 조회 (최신순) -->
    <select id="selectAllPlants" resultType="com.edu.springboot.dict.DictDTO">
	    SELECT plantidx, name, engname, category, 
	           CONCAT('/images/dict/', imgpath) AS imgpath
	    FROM plantdict
	    ORDER BY plantidx ASC
	</select>


    <!-- 관리자: 식물도감 삭제 -->
    <delete id="deletePlantDict" parameterType="int">
	    DELETE FROM plantdict WHERE plantidx = #{plantidx}
	</delete>
	
	
	<update id="updatePlantDict" parameterType="com.edu.springboot.dict.DictDTO">
    UPDATE plantdict 
    SET name = #{name},
        engname = #{engname},
        category = #{category},
        imgpath = COALESCE(#{imgpath,jdbcType=VARCHAR}, imgpath),
        growseason = #{growseason},
        bloomingseason = #{bloomingseason},
        sunlight = #{sunlight},
        humidity = #{humidity},
        temperature = #{temperature},
        water = #{water},
        disease = #{disease},
        summary = #{summary},
        note = #{note}
    WHERE plantidx = #{plantidx}
</update>

	
<!-- 
 -->
</mapper>